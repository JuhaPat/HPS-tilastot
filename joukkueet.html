<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Joukkue</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Yleiset asetukset */
    body {
      margin: 0;
      font-family: sans-serif;
    }
    /* Header: keskitetty HPS-logo, valikkonappi oikeassa yläkulmassa */
    header {
      text-align: center;
      padding: 20px 0;
      position: relative;
    }
    header img {
      width: 100px;
      height: auto;
      cursor: pointer;
    }
    /* Valikkonappi */
    .menu-button {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      background-color: rgb(0,100,40);
      border: none;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 1000;
    }
    .menu-button div {
      width: 25px;
      height: 3px;
      background-color: white;
      margin: 3px 0;
    }
    .menu {
      position: fixed;
      top: 55px;
      right: 10px;
      width: 200px;
      background-color: white;
      border: 2px solid rgb(0,100,40);
      border-radius: 5px;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.1);
      padding: 5px;
      z-index: 1000;
      display: none;
    }
    .menu a {
      display: block;
      color: rgb(0,100,40);
      text-decoration: none;
      font-weight: bold;
      border: 1px solid rgb(0,100,40);
      border-radius: 3px;
      margin: 2px 0;
      padding: 4px 8px;
      text-align: center;
    }
    .menu a:hover {
      background-color: rgb(0,100,40);
      color: white;
    }
    /* Näytettävä joukkue-tyyppi (Miehet/Naiset) */
    #team-type {
      text-align: center;
      color: green;
      font-size: 2.5rem;
      margin: 10px 0;
    }
    /* Vuosi ja nuolinavigaatio */
    .year-selector {
      text-align: center;
      margin: 20px 0;
    }
    .arrow-button {
      background-color: rgb(0,100,40);
      color: white;
      border: none;
      padding: 5px 10px;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 0 10px;
    }
    /* Otsikko "Joukkue XXXX" */
    #team-heading {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
    }
    /* Pelaajatiedot-taulukko */
    table.player-table {
      width: 60%;
      margin: 0 auto;
      border-collapse: collapse;
    }
    table.player-table th, table.player-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    /* Pelaajien nimien lihavointi ja linkittäminen */
    table.player-table a {
      text-decoration: none;
      color: inherit;
      font-weight: bold;
    }
    /* Joukkuekuvan alue, asetettu 80% leveäksi */
    #team-image {
      width: 60%;
      margin: 20px auto;
      text-align: center;
    }
    #team-image img {
      width: 100%;
      height: auto;
    }
  </style>
  <script>
    // Palautetaan JSON-tiedostojen kansio URL-parametrin "joukkue" perusteella
    function getTeamDataFolder() {
      const urlParams = new URLSearchParams(window.location.search);
      const teamParam = urlParams.get('joukkue');
      return teamParam === 'naiset' ? 'data naiset' : 'data miehet';
    }
  </script>
</head>
<body>
  <header>
    <!-- Valikkonappi näkyy oikeassa yläkulmassa -->
    <button class="menu-button" onclick="toggleMenu()">
      <div></div>
      <div></div>
      <div></div>
    </button>
    <div class="menu" id="menu">
      <a href="index.html">Etusivu</a>
      <a href="sijoitukset.html">Sijoitukset</a>
      <a href="kaudet.html">Kaudet</a>
      <a href="joukkueet.html" class="active">Joukkueet</a>
      <a href="pelaajat.html">Pelaajat</a>
      <a href="vastustajat.html">Vastustajat</a>
      <a href="tilastot.html">Tilastot</a>
    </div>
  </header>

  <main>
      <!-- HPS-logo lisätään nyt keskelle sivun yläosaa ennen joukkue-otsikkoa -->
  <div style="text-align: center; margin-bottom: 20px;">
    <a href="index.html"><img src="logot/HPS.jpg" alt="HPS Logo" style="width: 100px; height: auto;"></a>
  </div>
    <!-- Näytetään joukkue-parametrin perusteella "Miehet" tai "Naiset" -->
    <h1 id="team-type"></h1>
    <!-- Vuosi ja nuolinavigaatio -->
    <div class="year-selector">
      <button id="prev-year" class="arrow-button">&lt;</button>
      <span id="current-year">2024</span>
      <button id="next-year" class="arrow-button">&gt;</button>
    </div>
    <!-- Otsikko "Joukkue XXXX" -->
    <h2 id="team-heading"></h2>
    <!-- Joukkuekuva sijoitetaan nyt ennen pelaajatiedot-taulukkoa -->
    <div id="team-image">
      <img id="team-photo" src="" alt="Joukkuekuva">
    </div>
    <!-- Pelaajatiedot-taulukko -->
    <table id="players-table" class="player-table">
      <thead>
        <tr>
          <th>Sukunimi</th>
          <th>Etunimi</th>
          <th>Pelipaikka</th>
          <th>Muut roolit</th>
          <th>Pelit</th>
          <th>Maalit</th>
        </tr>
      </thead>
      <tbody>
        <!-- Tiedot täytetään JavaScriptillä -->
      </tbody>
    </table>
  </main>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('menu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // Funktio, joka lisää URL-parametrit "joukkue" ja "vuosi" kaikkiin sisäisiin linkkeihin
    function appendParamsToLinks() {
      const urlParams = new URLSearchParams(window.location.search);
      const joukkue = urlParams.get('joukkue');
      const vuosi = urlParams.get('vuosi');
      if (!joukkue) return;
      const links = document.querySelectorAll("a[href]");
      links.forEach(link => {
        let href = link.getAttribute("href");
        if (href && !href.match(/^https?:\/\//) && !href.startsWith("mailto:")) {
          const separator = href.indexOf("?") === -1 ? "?" : "&";
          href += `${separator}joukkue=${encodeURIComponent(joukkue)}`;
          if (vuosi) {
            href += `&vuosi=${encodeURIComponent(vuosi)}`;
          }
          link.setAttribute("href", href);
        }
      });
    }
    document.addEventListener("DOMContentLoaded", appendParamsToLinks);

    // Oletusparametrit: jos vuosi-parametriä ei anneta, käytetään 2024.
    const urlParams = new URLSearchParams(window.location.search);
    const teamParam = urlParams.get('joukkue');
    const vuosiParam = urlParams.get('vuosi') || "2024";
    const dataFolder = getTeamDataFolder();

    // Näytetään joukkue-otsikko (Miehet/Naiset) isolla vihreällä fontilla
    const teamTypeElem = document.getElementById('team-type');
    teamTypeElem.textContent = teamParam === 'naiset' ? "Naiset" : "Miehet";

    // Näytetään vuosi nuolinavigaation kohdalla
    const currentYearElem = document.getElementById('current-year');
    currentYearElem.textContent = vuosiParam;

    // Aseta otsikko "Joukkue XXXX"
    const teamHeadingElem = document.getElementById('team-heading');
    teamHeadingElem.textContent = "Joukkue " + vuosiParam;

    // Nuolinavigaatio vuosille (esimerkkinä vuodet 1917–2024)
    const years = [];
    for (let y = 1917; y <= 2024; y++) {
      years.push(y.toString());
    }
    const prevYearButton = document.getElementById('prev-year');
    const nextYearButton = document.getElementById('next-year');
    prevYearButton.addEventListener('click', () => {
      const index = years.indexOf(vuosiParam);
      if (index > 0) {
        const newYear = years[index - 1];
        window.location.search = `?joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(newYear)}`;
      }
    });
    nextYearButton.addEventListener('click', () => {
      const index = years.indexOf(vuosiParam);
      if (index < years.length - 1) {
        const newYear = years[index + 1];
        window.location.search = `?joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(newYear)}`;
      }
    });

    // Hae pelaajatiedot ja täytä pelaajat-taulukko.
    // Käytetään kenttiä "Kaikki pelit" ja "Kaikki maalit" sarakkeissa "Pelit" ja "Maalit".
    fetch(`${dataFolder}/pelaajat.json`)
      .then(response => response.json())
      .then(playersData => {
        const tableBody = document.querySelector("#players-table tbody");
        const filteredPlayers = playersData.filter(player => player.Kausi === vuosiParam);
        tableBody.innerHTML = filteredPlayers.map(player => {
          // Pelaajakortti-linkit: sukunimi ja etunimi lihavoituina
          const surnameLink = `<a href="pelaajakortti.html?sukunimi=${encodeURIComponent(player["Sukunimi"])}&etunimi=${encodeURIComponent(player["Etunimi"])}&joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(vuosiParam)}">
                                <strong>${player["Sukunimi"] || ""}</strong></a>`;
          const firstnameLink = `<a href="pelaajakortti.html?sukunimi=${encodeURIComponent(player["Sukunimi"])}&etunimi=${encodeURIComponent(player["Etunimi"])}&joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(vuosiParam)}">
                                <strong>${player["Etunimi"] || ""}</strong></a>`;
          return `
            <tr>
              <td>${surnameLink}</td>
              <td>${firstnameLink}</td>
              <td>${player["Pelipaikka"] || ""}</td>
              <td>${player["Muut roolit"] || ""}</td>
              <td>${player["Kaikki pelit"] || 0}</td>
              <td>${player["Kaikki maalit"] || 0}</td>
            </tr>
          `;
        }).join('');
      })
      .catch(error => console.error('Virhe ladattaessa pelaajatietoja:', error));

    // Aseta joukkuekuva: tiedostonimi on "AAA BBB.jpg", missä AAA on "Miehet" tai "Naiset" ja BBB on vuosiParam
    const teamPhotoElem = document.getElementById('team-photo');
    teamPhotoElem.src = `Kuvat/${teamParam === 'naiset' ? 'Naiset' : 'Miehet'} ${vuosiParam}.jpg`;
  </script>
</body>
</html>
