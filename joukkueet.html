<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Joukkue</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Yleiset asetukset */
    body {
      margin: 0;
      font-family: sans-serif;
    }
    /* Header: keskitetty HPS-logo, valikkonappi oikeassa yläkulmassa */
    header {
      text-align: center;
      padding: 20px 0;
      position: relative;
    }
    header img {
      width: 100px;
      height: auto;
      cursor: pointer;
    }
    /* Valikkonappi */
    .menu-button {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      background-color: rgb(0,100,40);
      border: none;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 1000;
    }
    .menu-button div {
      width: 25px;
      height: 3px;
      background-color: white;
      margin: 3px 0;
    }
    .menu {
      position: fixed;
      top: 55px;
      right: 10px;
      width: 200px;
      background-color: white;
      border: 2px solid rgb(0,100,40);
      border-radius: 5px;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.1);
      padding: 5px;
      z-index: 1000;
      display: none;
    }
    .menu a {
      display: block;
      color: rgb(0,100,40);
      text-decoration: none;
      font-weight: bold;
      border: 1px solid rgb(0,100,40);
      border-radius: 3px;
      margin: 2px 0;
      padding: 4px 8px;
      text-align: center;
    }
    .menu a:hover {
      background-color: rgb(0,100,40);
      color: white;
    }
    /* Näytettävä joukkue-tyyppi (Miehet/Naiset) */
    #team-type {
      text-align: center;
      color: green;
      font-size: 2.5rem;
      margin: 10px 0;
    }
    /* Vuosi ja nuolinavigaatio */
    .year-selector {
      text-align: center;
      margin: 20px 0;
    }
    .arrow-button {
      background-color: rgb(0,100,40);
      color: white;
      border: none;
      padding: 5px 10px;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 0 10px;
    }
    /* Pelaajatiedot-taulukko */
    table.player-table {
      width: 60%;
      margin: 0 auto;
      border-collapse: collapse;
    }
    table.player-table th, table.player-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    /* Ensimmäinen sarake (Kuva) – kiinteä leveys */
    table.player-table th:first-child,
    table.player-table td:first-child {
      width: 35px;
      text-align: center;
      padding: 0;
    }
    /* Linkitetyt nimet */
    table.player-table a {
      text-decoration: none;
      color: inherit;
      font-weight: bold;
    }
    /* Joukkuekuvan alue */
    #team-image {
      width: 60%;
      margin: 20px auto;
      text-align: center;
    }
    #team-image img {
      width: 100%;
      height: auto;
    }
    /* Pelaajakuvat: pyöreät, kokoa 35×35px, object-fit: cover */
    table.player-table td:first-child .player-image {
      border-radius: 50%;
      width: 35px;
      height: 35px;
      object-fit: cover;
      display: block;
      margin: 0 auto;
    }
    /* Valikko pelityypin valintaa varten */
    .valintalista-container {
      margin: 10px 0 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .valintalista-container label {
      font-weight: bold;
      margin-right: 6px;
    }
    .valintalista-container select {
      margin-right: 10px;
    }
    /* Klikattavat otsikot */
    th.sortable {
      cursor: pointer;
    }
  </style>
  <script>
    // Palauttaa JSON-tiedostojen kansion URL-parametrin "joukkue" perusteella
    function getTeamDataFolder() {
      const urlParams = new URLSearchParams(window.location.search);
      const teamParam = urlParams.get('joukkue');
      return teamParam === 'naiset' ? 'data naiset' : 'data miehet';
    }
  </script>
</head>
<body>
  <header>
    <!-- Valikkonappi -->
    <button class="menu-button" onclick="toggleMenu()">
      <div></div>
      <div></div>
      <div></div>
    </button>
    <div class="menu" id="menu">
      <a href="index.html">Etusivu</a>
      <a href="sijoitukset.html">Sijoitukset</a>
      <a href="kaudet.html">Kaudet</a>
      <a href="joukkueet.html" class="active">Joukkueet</a>
      <a href="pelaajat.html">Pelaajat</a>
      <a href="vastustajat.html">Vastustajat</a>
      <a href="tilastot.html">Tilastot</a>
    </div>
  </header>

  <main>
    <div style="text-align: center; margin-bottom: 20px;">
      <a href="index.html"><img src="logot/HPS.jpg" alt="HPS Logo" style="width: 100px; height: auto;"></a>
    </div>
    <!-- Näytetään joukkue-parametrin perusteella Miehet tai Naiset -->
    <h1 id="team-type"></h1>
    <!-- Vuosi ja nuolinavigaatio -->
    <div class="year-selector">
      <button id="prev-year" class="arrow-button">&lt;</button>
      <span id="current-year">2024</span>
      <button id="next-year" class="arrow-button">&gt;</button>
    </div>
    <!-- Joukkuekuva -->
    <div id="team-image">
      <img id="team-photo" src="" alt="Joukkuekuva">
    </div>
    <!-- Valitse pelityyppi -valikko; sama logiikka kuin pelaajat.html:ssä -->
    <div class="valintalista-container">
      <div>
        <label for="pelityyppi">Valitse pelityyppi:</label>
        <select id="pelityyppi">
          <option value="kaikki">Kaikki pelit</option>
          <option value="kilpailulliset" selected>Kilpailulliset pelit</option>
          <option value="sarja">Sarjapelit</option>
        </select>
      </div>
    </div>
    <!-- Pelaajatiedot-taulukko -->
    <table id="players-table" class="player-table">
      <thead>
        <tr>
          <th>Kuva</th>
          <th data-sort="sukunimi" class="sortable">Sukunimi</th>
          <th data-sort="etunimi" class="sortable">Etunimi</th>
          <th>Pelipaikka</th>
          <th>Muut roolit</th>
          <th data-sort="pelit" class="sortable">Pelit</th>
          <th data-sort="maalit" class="sortable">Maalit</th>
        </tr>
      </thead>
      <tbody>
        <!-- Tiedot täytetään JavaScriptillä -->
      </tbody>
    </table>
  </main>

  <script>
    // Näytä/piilota valikkopaneeli
    function toggleMenu() {
      const menu = document.getElementById('menu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // Lisää URL-parametrit kaikkiin sisäisiin linkkeihin
    function appendParamsToLinks() {
      const urlParams = new URLSearchParams(window.location.search);
      const joukkue = urlParams.get('joukkue');
      const vuosi = urlParams.get('vuosi');
      if (!joukkue) return;
      const links = document.querySelectorAll("a[href]");
      links.forEach(link => {
        let href = link.getAttribute("href");
        if (href && !href.match(/^https?:\/\//) && !href.startsWith("mailto:")) {
          const separator = href.indexOf("?") === -1 ? "?" : "&";
          href += `${separator}joukkue=${encodeURIComponent(joukkue)}`;
          if (vuosi) {
            href += `&vuosi=${encodeURIComponent(vuosi)}`;
          }
          link.setAttribute("href", href);
        }
      });
    }
    document.addEventListener("DOMContentLoaded", appendParamsToLinks);

    // Aseta joukkue- ja vuosi-parametrit
    const urlParams = new URLSearchParams(window.location.search);
    const teamParam = urlParams.get('joukkue');
    const vuosiParam = urlParams.get('vuosi') || "2024";
    const dataFolder = getTeamDataFolder();

    // Näytä joukkueen nimi
    const teamTypeElem = document.getElementById('team-type');
    teamTypeElem.textContent = teamParam === 'naiset' ? "Naiset" : "Miehet";

    // Vuoden asetus nuolinavigaation avulla
    const currentYearElem = document.getElementById('current-year');
    currentYearElem.textContent = vuosiParam;
    const prevYearButton = document.getElementById('prev-year');
    const nextYearButton = document.getElementById('next-year');
    prevYearButton.addEventListener('click', () => {
      const years = [];
      for (let y = 1917; y <= 2024; y++) { years.push(y.toString()); }
      const index = years.indexOf(vuosiParam);
      if (index > 0) {
        const newYear = years[index - 1];
        window.location.search = `?joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(newYear)}`;
      }
    });
    nextYearButton.addEventListener('click', () => {
      const years = [];
      for (let y = 1917; y <= 2024; y++) { years.push(y.toString()); }
      const index = years.indexOf(vuosiParam);
      if (index < years.length - 1) {
        const newYear = years[index + 1];
        window.location.search = `?joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(newYear)}`;
      }
    });

    // Globaalit muuttujat taulukon tietojen hallintaan
    const pelityyppiSelect = document.getElementById('pelityyppi');
    let currentPlayers = [];
    // Oletusjärjestys: "Pelit" –sarakkeessa (laskettuna laskevasti)
    let currentSortCriteria = "pelit";
    let currentSortDirection = "desc";

    // Renderöidään taulukko; pelityypin mukaan näytetään oikeat pelien ja maalien määrät
    function renderTable(players) {
      const tableBody = document.querySelector("#players-table tbody");
      tableBody.innerHTML = players.map(player => {
        let pelitCount, maalitCount;
        if (pelityyppiSelect.value === "kaikki") {
          pelitCount = player["Kaikki pelit"] || 0;
          maalitCount = player["Kaikki maalit"] || 0;
        } else if (pelityyppiSelect.value === "kilpailulliset") {
          pelitCount = player["S+K pelit"] || 0;
          maalitCount = player["S+K maalit"] || 0;
        } else {
          pelitCount = player["S pelit"] || 0;
          maalitCount = player["S maalit"] || 0;
        }
        const surnameLink = `<a href="pelaajakortti.html?sukunimi=${encodeURIComponent(player["Sukunimi"])}&etunimi=${encodeURIComponent(player["Etunimi"])}&joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(vuosiParam)}"><strong>${player["Sukunimi"] || ""}</strong></a>`;
        const firstnameLink = `<a href="pelaajakortti.html?sukunimi=${encodeURIComponent(player["Sukunimi"])}&etunimi=${encodeURIComponent(player["Etunimi"])}&joukkue=${encodeURIComponent(teamParam)}&vuosi=${encodeURIComponent(vuosiParam)}"><strong>${player["Etunimi"] || ""}</strong></a>`;
        const playerImage = `<img src="pelaajakuvat/${player["Etunimi"]} ${player["Sukunimi"]}.jpg" alt="Pelaajan kuva" onerror="this.onerror=null;this.src='pelaajakuvat/pelaajakuva.jpg';" class="player-image">`;
        return `
          <tr>
            <td>${playerImage}</td>
            <td>${surnameLink}</td>
            <td>${firstnameLink}</td>
            <td>${player["Pelipaikka"] || ""}</td>
            <td>${player["Muut roolit"] || ""}</td>
            <td>${pelitCount}</td>
            <td>${maalitCount}</td>
          </tr>
        `;
      }).join('');
    }

    // Funktio pelaajien vertaamiseen; käsitellään sukunimi, etunimi sekä pelit/maalit käyttäen pelityyppiä
    function comparePlayers(a, b, key, order) {
      let valA, valB;
      const currentPelityyppi = pelityyppiSelect.value;
      if (key === "sukunimi") {
        valA = (a["Sukunimi"] || "").toString().toLowerCase();
        valB = (b["Sukunimi"] || "").toString().toLowerCase();
      } else if (key === "etunimi") {
        valA = (a["Etunimi"] || "").toString().toLowerCase();
        valB = (b["Etunimi"] || "").toString().toLowerCase();
      } else if (key === "pelit") {
        if (currentPelityyppi === "kaikki") {
          valA = Number(a["Kaikki pelit"] || 0);
          valB = Number(b["Kaikki pelit"] || 0);
        } else if (currentPelityyppi === "kilpailulliset") {
          valA = Number(a["S+K pelit"] || 0);
          valB = Number(b["S+K pelit"] || 0);
        } else {
          valA = Number(a["S pelit"] || 0);
          valB = Number(b["S pelit"] || 0);
        }
      } else if (key === "maalit") {
        if (currentPelityyppi === "kaikki") {
          valA = Number(a["Kaikki maalit"] || 0);
          valB = Number(b["Kaikki maalit"] || 0);
        } else if (currentPelityyppi === "kilpailulliset") {
          valA = Number(a["S+K maalit"] || 0);
          valB = Number(b["S+K maalit"] || 0);
        } else {
          valA = Number(a["S maalit"] || 0);
          valB = Number(b["S maalit"] || 0);
        }
      } else {
        return 0;
      }
      if(valA < valB) return order === "asc" ? -1 : 1;
      if(valA > valB) return order === "asc" ? 1 : -1;
      return 0;
    }

    // Oletusjärjestyksen suuntatoiminto: sukunimi ja etunimi nousevasti, muut laskevasti
    function defaultDirection(criteria) {
      if (criteria === 'sukunimi' || criteria === 'etunimi') {
        return 'asc';
      } else {
        return 'desc';
      }
    }

    // Lisätään klikkaustapahtumat vain niihin otsikoihin, jotka ovat järjestettäviä
    document.querySelectorAll("#players-table thead th.sortable").forEach((th) => {
      th.style.cursor = "pointer";
      th.addEventListener("click", () => {
        const criteria = th.getAttribute("data-sort");
        if (currentSortCriteria === criteria) {
          currentSortDirection = currentSortDirection === "asc" ? "desc" : "asc";
        } else {
          currentSortCriteria = criteria;
          currentSortDirection = defaultDirection(criteria);
        }
        currentPlayers.sort((a, b) => comparePlayers(a, b, criteria, currentSortDirection));
        renderTable(currentPlayers);
      });
    });

    // Kun pelityyppi muuttuu, lajitellaan uudelleen nykyisen järjestyksen mukaisesti
    pelityyppiSelect.addEventListener('change', () => {
      currentPlayers.sort((a, b) => comparePlayers(a, b, currentSortCriteria, currentSortDirection));
      renderTable(currentPlayers);
    });

    // Haetaan pelaajatiedot ja suodatetaan kauden mukaan.
    fetch(`${dataFolder}/pelaajat.json`)
      .then(response => response.json())
      .then(playersData => {
        currentPlayers = playersData.filter(player => player.Kausi === vuosiParam);
        // Oletusarvona lajitellaan "Pelit"-sarakkeen mukaan (suurimmasta pienimpään)
        currentPlayers.sort((a, b) => comparePlayers(a, b, "pelit", "desc"));
        renderTable(currentPlayers);
      })
      .catch(error => console.error('Virhe ladattaessa pelaajatietoja:', error));

    // Aseta joukkuekuva: tiedostonimi on "AAA BBB.jpg", missä AAA on "Miehet" tai "Naiset" ja BBB on vuosiParam
    const teamPhotoElem = document.getElementById('team-photo');
    teamPhotoElem.src = `Kuvat/${teamParam === 'naiset' ? 'Naiset' : 'Miehet'} ${vuosiParam}.jpg`;
  </script>
</body>
</html>
